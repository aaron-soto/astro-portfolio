---
import SpinnerIcon from "../components/icons/SpinnerIcon.astro";
import Layout from "../layouts/Layout.astro";
import { SOCIAL_LINKS } from "../lib/data";
---

<Layout>
  <div class="container">
    <h1>contact me</h1>
    <p>
      feel free to reach out to me via email at
      <a
        href="mailto:aaron@ayezeewebdesigns.com"
        class="text-primary hover:underline">aaron@ayezeewebdesigns.com</a
      >
    </p>

    <p class="mt-6">
      you can also find me on social media:
      <ul class="flex gap-6 mt-2">
        {
          Object.values(SOCIAL_LINKS).map((link) => (
            <li>
              <a href={link.url} class="text-primary hover:underline">
                {link.name}
              </a>
            </li>
          ))
        }
      </ul>
    </p>

    <form id="contact-form" class="w-full grid grid-cols-4 md:grid-cols-8">
      <div class="col-span-4">
        <label for="name" class="block mt-4 mb-2">name:</label>
        <input
          type="text"
          id="name"
          name="name"
          class="w-full border border-lines bg-neutral-950 py-2 px-3"
          required
        />

        <label for="email" class="block mt-4 mb-2">email:</label>
        <input
          type="email"
          id="email"
          name="email"
          class="w-full border border-lines bg-neutral-950 py-2 px-3"
          required
        />

        <label for="message" class="block mt-4 mb-2">message:</label>
        <textarea
          id="message"
          name="message"
          rows="5"
          class="w-full border border-lines bg-neutral-950 py-2 px-3"
          required></textarea>

        <button
          type="submit"
          id="submit-button"
          class="mt-4 bg-neutral-950 hover:bg-neutral-900 border border-lines text-white py-2.5 px-4 w-1/2 transition-all flex items-center justify-center h-[46px]"
        >
          <span id="button-text" class="flex items-center justify-center h-6"
            >send message</span
          >
          <span
            id="button-spinner"
            class="hidden items-center justify-center h-6"
          >
            <SpinnerIcon />
          </span>
        </button>

        <!-- Message display area -->
        <div id="form-message" class="hidden mt-4 p-3 border rounded text-sm">
        </div>
      </div>
    </form>
  </div>
</Layout>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("contact-form") as HTMLFormElement;
    const submitButton = document.getElementById(
      "submit-button"
    ) as HTMLButtonElement;
    const buttonText = document.getElementById(
      "button-text"
    ) as HTMLSpanElement;
    const buttonSpinner = document.getElementById(
      "button-spinner"
    ) as HTMLSpanElement;
    const formMessage = document.getElementById(
      "form-message"
    ) as HTMLDivElement;

    function showMessage(message: string, isSuccess: boolean = true) {
      formMessage.textContent = message;
      formMessage.classList.remove("hidden");

      if (isSuccess) {
        formMessage.classList.remove(
          "border-red-500",
          "bg-red-950",
          "text-red-200"
        );
        formMessage.classList.add(
          "border-green-500",
          "bg-green-950",
          "text-green-200"
        );
      } else {
        formMessage.classList.remove(
          "border-green-500",
          "bg-green-950",
          "text-green-200"
        );
        formMessage.classList.add(
          "border-red-500",
          "bg-red-950",
          "text-red-200"
        );
      }
    }

    function hideMessage() {
      formMessage.classList.add("hidden");
    }

    form.addEventListener("submit", async function (e) {
      e.preventDefault();

      // Hide any previous messages
      hideMessage();

      // Disable the button and show spinner
      submitButton.disabled = true;
      submitButton.classList.add("opacity-75", "cursor-not-allowed");
      buttonText.classList.add("hidden");
      buttonSpinner.classList.remove("hidden");
      buttonSpinner.classList.add("flex");

      // Simulate API call with 2-3 second delay
      try {
        await new Promise((resolve) => setTimeout(resolve, 2500));

        // Simulate successful response
        showMessage(
          "Message sent successfully! I'll get back to you soon. Thank you!",
          true
        );

        // Reset form
        form.reset();
      } catch (error) {
        // Handle error (optional)
        showMessage("Something went wrong. Please try again.", false);
      } finally {
        // Reset button state
        submitButton.disabled = false;
        submitButton.classList.remove("opacity-75", "cursor-not-allowed");
        buttonText.classList.remove("hidden");
        buttonSpinner.classList.add("hidden");
        buttonSpinner.classList.remove("flex");
      }
    });
  });
</script>
