---
import WorkLayout from "../components/WorkLayout.astro";
import {
  initCmsHelper,
  getModuleDataBySlug,
  type CMSCache,
} from "ayezee-astro-cms";
import cmsData from "../data/cms-cache.json";
import { slugify } from "../lib/utils";

// Initialize CMS helper
initCmsHelper(cmsData as CMSCache);

// Get work projects from CMS
const cmsWorkData = getModuleDataBySlug("work");

// Transform CMS data to match expected format
const workPosts = cmsWorkData.map((item) => {
  const data = item.data as Record<string, any>;
  const generatedSlug = data.slug || slugify(data.title || item.id);

  return {
    id: item.id,
    slug: generatedSlug,
    data: {
      title: data.title || "Untitled",
      slug: generatedSlug,
      description: data.description || "",
      category: data.category || "",
      heroImage: data.featured_image || "",
      url: data.project_url || "",
      logo: data.logo || "",
      metaTitle: data.title || "Untitled",
      metaDescription: data.description || "",
    },
  };
});
---

<WorkLayout posts={workPosts} />
