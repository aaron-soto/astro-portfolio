---
import BlogLayout from "../components/BlogLayout.astro";
import { getAllTags, safeDate } from "../lib/utils";
import { getModuleDataBySlug } from "../lib/ayezee-cms-helper";

// Get blog posts from CMS
const cmsBlogData = getModuleDataBySlug("blog");

// Transform CMS data to match the expected format
const blogPosts = cmsBlogData.map((item) => {
  const data = item.data as Record<string, any>;
  const pubDate = safeDate(data.pubDate || item.createdAt);
  const updatedDate = item.updatedAt ? safeDate(item.updatedAt) : undefined;

  return {
    id: item.id,
    slug: data.slug || item.id,
    body: data.content || "",
    data: {
      title: data.title || "Untitled",
      slug: data.slug || item.id, // Add slug to data object for BlogGrid component
      description: data.excerpt || data.description || "",
      pubDate,
      updatedDate,
      heroImage: data.featured_image || data.heroImage,
      tags: data.tags || [],
    },
  };
});

const allTags = getAllTags(blogPosts);
---

<BlogLayout allTags={allTags} posts={blogPosts} />
