---
import BlogPost from "../../layouts/BlogPost.astro";
import { getModuleData } from "../../lib/ayezee-cms-helper";

export async function getStaticPaths() {
  try {
    const blogPostData = await getModuleData(import.meta.env.PUBLIC_BLOG_KEY);
    console.log("=== Blog Posts for Static Paths ===");
    console.log("Total posts:", blogPostData.data.length);
    blogPostData.data.forEach((post: any, idx: number) => {
      console.log(
        `${idx + 1}. slug: "${post.data.slug}" | title: "${post.data.title}"`
      );
    });
    console.log("===================================");

    return blogPostData.data.map((post: any) => ({
      params: { slug: post.data.slug },
      props: { post },
    }));
  } catch (error) {
    console.error("Error fetching blog posts for static paths:", error);
    return [];
  }
}

const { post } = Astro.props;
---

<BlogPost
  title={post.data.title}
  description={post.data.description || post.data.excerpt || ""}
  pubDate={new Date(post.data.published_date || post.createdAt)}
  updatedDate={post.updatedAt ? new Date(post.updatedAt) : undefined}
  heroImage={post.data.featured_image}
  category={post.data.category}
>
  <div set:html={post.data.content} />
</BlogPost>
