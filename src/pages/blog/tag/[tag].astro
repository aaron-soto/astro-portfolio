---
import BlogLayout from "../../../components/BlogLayout.astro";
import { getAllTags } from "../../../lib/utils";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const blogPosts = await getCollection("blog");
  const allTags = getAllTags(blogPosts);

  return allTags.map((tag) => ({
    params: { tag: encodeURIComponent(tag) },
    props: { blogPosts, allTags, selectedTag: tag },
  }));
}

const { blogPosts, allTags, selectedTag } = Astro.props;
const decodedTag = decodeURIComponent(Astro.params.tag || selectedTag);
const filteredPosts = blogPosts.filter((post: any) =>
  post.data?.tags?.includes(decodedTag)
);
---

<BlogLayout allTags={allTags} currentTag={selectedTag} posts={filteredPosts} />
